<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nền tảng AI Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      // IIFE to avoid polluting global scope
      (function() {
        try {
          // Synchronous request to get theme config before rendering
          var xhr = new XMLHttpRequest();
          xhr.open('GET', '/api/system-config', false); // `false` makes it synchronous
          xhr.send(null);

          var themeName = 'w5g'; // Default theme
          if (xhr.status === 200) {
            var config = JSON.parse(xhr.responseText);
            if (config && config.template) {
              themeName = config.template;
            }
          }
          
          var themePath = '/themes/' + themeName + '/theme.css';
          
          // Use document.write to insert link tags before the body renders.
          // This is a valid use case for document.write.
          document.write('<link rel="preload" href="' + themePath + '" as="style">');
          document.write('<link rel="stylesheet" href="' + themePath + '" id="theme-style">');
          
        } catch (e) {
          console.error('Failed to pre-load theme CSS, falling back to default.', e);
          // Fallback in case of any error
          var fallbackThemePath = '/themes/w5g/theme.css';
          document.write('<link rel="preload" href="' + fallbackThemePath + '" as="style">');
          document.write('<link rel="stylesheet" href="' + fallbackThemePath + '" id="theme-style">');
        }
      })();
    </script>
</head>
  <body class="antialiased">
    <div id="root"></div>
    <script type="module" src="/src/index.tsx"></script>
  </body>
</html>